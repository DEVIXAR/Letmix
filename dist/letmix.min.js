/*! 
Copyright (c) 2016, letmix - v0.1.3. All rights reserved.
2016-08-08
dev Didyk Mikhail (DEVIXAR).
For licensing, see LICENSE.md
http://devixar.com */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(window.jQuery)}(function(a){var b={SPACE:32,NEW_ROW:10},c=function(a){a.text("")},d=function(c){return a.inArray(c.charCodeAt(0),[b.SPACE,b.NEW_ROW])===-1},e=function(b){var c=[];return a(b).each(function(a,b){c.push(b.replace(/\s/gi,"&nbsp;"))}),c},f=function(c){var d=[];return a(new String(c.text())).each(function(c,e){a.inArray(e.charCodeAt(0),[b.SPACE,b.NEW_ROW])===-1?d.push("<span>"+e+"</span>"):d.push(e)}),d},g=function(a){a.children().length>0||a.html(f($this))},h=function(a){return a[Math.floor(Math.random()*(a.length-0)+0)]},i=function(a,b){return a[b<a.length?b:b-a.length*Math.floor(b/a.length)]},j=function(a,b,c){var d=b<c.length?b:b-c.length*Math.floor(b/c.length),e=c[d];return e>=a.length&&(e=a.length-1),a[e]},k=function(a,b,c,d){switch("undefined"==typeof c&&(c=0),b){case"random":return h(a);case"line":return i(a,c);case"custom":return d.amountIterations=a.length,j(a,c,d.customOrder)}},l=function(a){var b="#CF3636";return"undefined"==typeof a?b:(a=a.replace(/\s/gi,""),/^#([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$/.test(a)?a:/^([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$/.test(a)?"#"+a:/^([0-9]{1,3},[0-9]{1,3},[0-9]{1,3})$/.test(a)?"rgb("+a+")":/^([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},[0-9]{1,3})$/.test(a)?"rgba("+a+")":b)},m=function(a,b,c){a.append('<span style="color: '+c+';" class="letmix--char">'+b+"</span>")},n=function(a){a.find(".letmix--char").detach()},o=function(b,c,d){a(b.children().get(d-1)).css({color:c})},p=function(b,c){a(b.children().get(c-1)).css({color:""})},q=function(a){return a.replace(/\s/gi,"")},r=function(a,b,c,d,e){b>0?setTimeout(function(){a(c,d,e)},b):a(c,d,e)},s=function(a,b,c,d,e,f){function g(h){h=b(a,h),setTimeout(function(){c(a,h),e(a,h)?g(h):d()},f.time)}g(f.startIterator)},t=function(a){"undefined"==typeof a.data("origin")&&a.data("origin",a.text())},u=function(a){return a.data("origin")},v=function(a){a.data().callback.length>0&&(a.data().callback[0](a),a.data().callback=a.data().callback.splice(1,a.data().callback.length))},w=function(a,b,c){var d=q(u(a)).indexOf(b.stopWhere);b.color=l(b.color),s(a,function(c,d){return o(a,b.color?b.color:l(""),d),--d},function(c,e){b.stopWhere&&e<d+b.stopWhere.length||p(a,e+1)},function(){c()},function(a,c){return 0===b.stopWhere.length?c>0:c>d},{time:b.speed,startIterator:a.children().length+1})},x=function(a,b,c){var d=q(u(a)).indexOf(b.stopWhere);b.color=l(b.color),s(a,function(c,d){return o(a,b.color?b.color:l(""),d),++d},function(c,e){b.stopWhere&&e>d+1||p(a,e-1)},function(){c()},function(a,c){return 0===b.stopWhere.length?c<a.children().length:c<=d+b.stopWhere.length},{time:b.speed,startIterator:1,setting:b,wherePos:d})},y=function(a,b,c){c.start(a);var e=function(d,f,g,h){n(a);var i=k(c.chars,c.typeIteration,d,c);m(a,i,l(c.colorIteration)),d<(c.amountIterations>0?c.amountIterations:c.chars.length)?setTimeout(function(){e(++d,f,g,h)},c.speedIteration):(n(a),g(),f==b.length-1&&h())},f=function(c,g){d(b[c])?e(0,c,function(){a.append(b[c]),c++,b[c]&&f(c,g)},g):(a.append(b[c]),f(++c,g))};f(0,function(){a.data("inprogress",!1),c.end(a),v(a)})},z={initData:function(a){a.data("callback")||a.data("callback",[])},init:function(b){var d=a.extend({amountIterations:3,colorIteration:"CF3636",chars:["A","a","B","b","C","c","1","2","3"],typeIteration:"random",customOrder:[2,1,0],speedIteration:30,wait:0,start:function(){},end:function(){}},b);return z.inited=!0,this.each(function(){if($this=a(this),"undefined"!=typeof $this.data("inprogress")&&$this.data("inprogress"))return!1;$this.data("inprogress",!0),z.initData($this);var b=f($this);t($this),d.chars=e(d.chars),r(function(a,b,d){c(a),y(a,b,d)},d.wait,$this,b,d)})},runner:function(b){function c(a){switch(d.direction){case"right=>left":w(a,d,function(){"undefined"!=typeof d.end&&(a.data("inprogress",!1),a.data("direction",[]),d.end(a),v(a))});break;case"left=>right":x(a,d,function(){"undefined"!=typeof d.end&&(a.data("inprogress",!1),a.data("direction",[]),d.end(a),v(a))})}}var d=a.extend({speed:50,color:"CF3636",direction:"right=>left",stopWhere:"",wait:0,start:function(){},end:function(){}},b);d.stopWhere=q(d.stopWhere);var e=this;if(!("undefined"!=typeof e.data("direction")&&a.inArray(e,e.data("direction"))>-1))return"undefined"==typeof e.data("direction")?e.data("direction",[d.direction]):e.data("direction").push(d.direction),e.data("inprogress",!0),g(e),this.each(function(){e=a(this),z.initData(e),t(e);f(e);r(function(a,b,d){d.start(a),c(a,b,d)},d.wait,e,u(e),d)})}};a.fn.ThenFlash=function(b){return $this.each(function(c,d){$this=a(this),z.initData($this),a(d).data().callback.push(b)})},a.fn.Letmix=function(b){return z[b]?z[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("can't load method "+b):z.init.apply(this,arguments)}});